const maps = [
  {
    mapName: "dust ii",
    positions: [
      {
        posicao: "altar",
        posicaoImg: "https://i.postimg.cc/XqPkYXRL/altar.jpg",
      },
      {
        posicao: "base ct",
        posicaoImg: "https://i.postimg.cc/DybqcfkV/base-ct.jpg",
      },
      {
        posicao: "base tr",
        posicaoImg: "https://i.postimg.cc/sgd5HFsM/base-tr.jpg",
      },
      {
        posicao: "bomb a",
        posicaoImg: "https://i.postimg.cc/JzNZ9TzP/bomb-a.jpg",
      },
      {
        posicao: "bomb b",
        posicaoImg: "https://i.postimg.cc/V66t0mBV/bomb-b.jpg",
      },
      {
        posicao: "bunker",
        posicaoImg: "https://i.postimg.cc/HL35LV5M/bunker.jpg",
      },
      {
        posicao: "buraco",
        posicaoImg: "https://i.postimg.cc/bJBtQWmN/buraco.jpg",
      },
      {
        posicao: "carro a",
        posicaoImg: "https://i.postimg.cc/hvQ7MsY8/carro-a.jpg",
      },
      {
        posicao: "carro b",
        posicaoImg: "https://i.postimg.cc/rz6RHW6B/carro-b.jpg",
      },
      {
        posicao: "coqueiro",
        posicaoImg: "https://i.postimg.cc/Kc19d2Sf/coqueiro.jpg",
      },
      {
        posicao: "escuro alto",
        posicaoImg: "https://i.postimg.cc/c1PDWbdS/escuro-alto.jpg",
      },
      {
        posicao: "escuro baixo",
        posicaoImg: "https://i.postimg.cc/NfTdjk0r/escuro-baixo.jpg",
      },
      {
        posicao: "fundo",
        posicaoImg: "https://i.postimg.cc/8zStJfFX/fundo.jpg",
      },
      {
        posicao: "varanda",
        posicaoImg: "https://i.postimg.cc/vZtXW8fY/varanda.jpg",
      },
    ],
  },
  {
    mapName: "mirage",
    positions: [
      {
        posicao: "areia",
        posicaoImg: "https://i.postimg.cc/k5hQc24m/areia.jpg",
      },
      {
        posicao: "base ct",
        posicaoImg: "https://i.postimg.cc/SRcckVGS/base-ct.jpg",
      },
      {
        posicao: "base tr",
        posicaoImg: "https://i.postimg.cc/44c66NRD/base-tr.jpg",
      },
      {
        posicao: "bomb a",
        posicaoImg: "https://i.postimg.cc/RVQwYsFG/bomb-a.jpg",
      },
      {
        posicao: "bomb b",
        posicaoImg: "https://i.postimg.cc/28f42RzV/bomb-b.jpg",
      },
      {
        posicao: "caminho de rato",
        posicaoImg: "https://i.postimg.cc/9QmyHdw2/caminho-de-rato.jpg",
      },
      {
        posicao: "caverna",
        posicaoImg: "https://i.postimg.cc/2S0hk1nZ/caverna.jpg",
      },
      {
        posicao: "cozinha e tapete",
        posicaoImg: "https://i.postimg.cc/43ntmX1F/cozinha-tapete-b.jpg",
      },
      {
        posicao: "janelao",
        posicaoImg: "https://i.postimg.cc/hGwmmNy4/janelao.jpg",
      },
      {
        posicao: "l",
        posicaoImg: "https://i.postimg.cc/C1qqsJXG/l.jpg",
      },
      {
        posicao: "ligacao",
        posicaoImg: "https://i.postimg.cc/Bbf1YHfd/ligacao.jpg",
      },
      {
        posicao: "meio",
        posicaoImg: "https://i.postimg.cc/90Pwv0Wz/meio.jpg",
      },
      {
        posicao: "mercado",
        posicaoImg: "https://i.postimg.cc/rFcr51J4/mercado.jpg",
      },
      {
        posicao: "palacio",
        posicaoImg: "https://i.postimg.cc/kMWSV1x9/palacio.jpg",
      },
      {
        posicao: "cabecinha sanduiche tetris",
        posicaoImg:
          "https://i.postimg.cc/GhQsK475/tripla-cabecinha-sanduiche.jpg",
      },
      {
        posicao: "van",
        posicaoImg: "https://i.postimg.cc/nhh9PnNc/van.jpg",
      },
    ],
  },
  {
    mapName: "overpass",
    positions: [
      {
        posicao: "banco",
        posicaoImg: "https://i.postimg.cc/7h4fM4g4/banco.jpg",
      },
      {
        posicao: "bomb a",
        posicaoImg: "https://i.postimg.cc/ncHXXHFY/bomb-a.jpg",
      },
      {
        posicao: "bomb b",
        posicaoImg: "https://i.postimg.cc/bN3sbKdX/bomb-b.jpg",
      },
      {
        posicao: "caminhao",
        posicaoImg: "https://i.postimg.cc/T31hcCWK/caminhao.jpg",
      },
      {
        posicao: "canudo",
        posicaoImg: "https://i.postimg.cc/Cx25rkjm/canudo.jpg",
      },
      {
        posicao: "cimento",
        posicaoImg: "https://i.postimg.cc/nLQzyr2Z/cimento.jpg",
      },
      {
        posicao: "fundo",
        posicaoImg: "https://i.postimg.cc/26R6rY9W/fundo.jpg",
      },
      {
        posicao: "ligacao",
        posicaoImg: "https://i.postimg.cc/qRs77FW5/ligacao.jpg",
      },
      {
        posicao: "lixeira",
        posicaoImg: "https://i.postimg.cc/sx3gGcrD/lixeira.jpg",
      },
      {
        posicao: "rua",
        posicaoImg: "https://i.postimg.cc/sxKDYhjP/rua.jpg",
      },
      {
        posicao: "sapao",
        posicaoImg: "https://i.postimg.cc/fTTbwBC8/sapao.jpg",
      },
    ],
  },
  {
    mapName: "train",
    positions: [
      {
        posicao: "base ct",
        posicaoImg: "https://i.postimg.cc/8PKzsMnN/base-ct.jpg",
      },
      {
        posicao: "base tr",
        posicaoImg: "https://i.postimg.cc/KYLG9Vc8/base-tr.jpg",
      },
      {
        posicao: "bomb a",
        posicaoImg: "https://i.postimg.cc/XJbVt8Xc/bomb-a.jpg",
      },
      {
        posicao: "bombeiro",
        posicaoImg: "https://i.postimg.cc/9MYW2773/bombeiro.jpg",
      },
      {
        posicao: "casa branca",
        posicaoImg: "https://i.postimg.cc/0j59yyYz/casabranca.jpg",
      },
      {
        posicao: "fundo ct",
        posicaoImg: "https://i.postimg.cc/sfKV05z7/fundo-ct.jpg",
      },
      {
        posicao: "fundo tr",
        posicaoImg: "https://i.postimg.cc/vHBQRD8j/fundo-tr.jpg",
      },
      {
        posicao: "liga",
        posicaoImg: "https://i.postimg.cc/pX6PPxpd/liga-tr.jpg",
      },
    ],
  },
  {
    mapName: "inferno",
    positions: [
      {
        posicao: "base ct",
        posicaoImg: "https://i.postimg.cc/1XHbRrt1/base-ct.jpg",
      },
      {
        posicao: "base tr",
        posicaoImg: "https://i.postimg.cc/vHYpqkqY/base-tr.jpg",
      },
      {
        posicao: "bomb a",
        posicaoImg: "https://i.postimg.cc/sDTbtmqp/bomb-a.jpg",
      },
      {
        posicao: "banana",
        posicaoImg: "https://i.postimg.cc/zv591cqk/banana.jpg",
      },
      {
        posicao: "bomb b",
        posicaoImg: "https://i.postimg.cc/DwmRFs3R/bomb-b.jpg",
      },
      {
        posicao: "cogu",
        posicaoImg: "https://i.postimg.cc/bwMWvJzr/cogu.jpg",
      },
      {
        posicao: "cemiterio",
        posicaoImg: "https://i.postimg.cc/g0Z5LWJD/inferno-cemiterio.jpg",
      },
      {
        posicao: "nip",
        posicaoImg: "https://i.postimg.cc/sXCLpNGR/inferno-nip.jpg",
      },
      {
        posicao: "xuxa",
        posicaoImg: "https://i.postimg.cc/V69V4WX0/inferno-xuxa.jpg",
      },
      {
        posicao: "meio",
        posicaoImg: "https://i.postimg.cc/T1RHs5c7/meio.jpg",
      },
    ],
  },
];

window.onload = () => {
  valueSelectedMap = parseInt(localStorage.getItem("valueSelectedMap"));
  valueSelectedDiff = parseInt(localStorage.getItem("valueSelectedDiff"));

  runApp();
  setTimerByDifficulty();
};

// declaring variables, onEventListeners, ...
const verifyButton = document.querySelector(".verifyInput");
verifyButton.addEventListener("click", verifyInput);
const inputArea = document.querySelector(".insertPositionName");
// when the user click "enter", the function is called
inputArea.addEventListener("keyup", function (event) {
  if (event.keyCode === 13) {
    event.preventDefault();
    console.log("Ei!");
    verifyButton.click();
  }
});
const randomizeds = {};
let points = 0;
let health = 3;

// reseting points saved in the localstorage
localStorage.setItem("points", 0);

// method fisher-yates shuffle, used to randomize the positions
const randomize = (arr) => {
  const copy = [...arr];

  for (let i = copy.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [copy[i], copy[j]] = [copy[j], copy[i]];
  }

  return copy;
};

function basicLogic() {
  const randomized = randomizeds[valueSelectedMap]?.length
    ? randomizeds[valueSelectedMap]
    : randomize(maps[valueSelectedMap].positions); // o array que será randomizado com base no <select> do usuario

  randomizeds[valueSelectedMap] = randomized;

  actualPosition = randomized.shift();
}

let hint;

function runApp() {
  const imgArea = document.querySelector(".positionName");
  basicLogic();

  hint = actualPosition.posicao.replace(/\w/g, "*");
  imgArea.src = actualPosition.posicaoImg;

  if (valueSelectedDiff == 0) {
    inputArea.placeholder = hint;
  }
}

function verifyInput() {
  if (inputArea.value != "") {
    if (inputArea.value.toLowerCase() == actualPosition.posicao) {
      // if the answer is correct... +1 point
      points++;
      localStorage.setItem("points", points);
      if (randomizeds[valueSelectedMap].length == 0) {
        window.location.href = "./end.html";
        let showPointsArea = document.querySelector(".totalPoints");

        showPointsArea.innerHTML = `Você conseguiu ${parseInt(
          localStorage.getItem("valueSelectedMap")
        )} pontos!`;
      }

      inputArea.value = "";
      runApp();
    } else {
      if (health > 0) {
        let healthBar = document.querySelector("div.health-points");
        healthBar.classList.remove("lose-life");
        void healthBar.offsetWidth;
        healthBar.classList.add("lose-life");

        document.querySelector(".h" + health).src =
          "./public/img/empty_heart.png";
        health--;
      } else if (health == 0) {
        window.location.href = "./end.html";
      }
    }
  } else {
    Swal.fire({
      icon: "error",
      title: "Oops...",
      text: "Preencha o nome da posição!",
      width: 400,
      height: 300,
    });
  }
}

function setTimerByDifficulty() {
  time = 0;

  if (valueSelectedDiff == 0) {
    time = 60;
  } else if (valueSelectedDiff == 1) {
    time = 50;
  } else if (valueSelectedDiff == 2) {
    time = 40;
  }
}

let timer = setInterval(() => {
  const timeLeft = document.querySelector(".timeLeft");
  time -= 1;

  if (time < 0) {
    clearInterval(timer);
    window.location.href = "end.html";
  } else {
    timeLeft.innerHTML = time;
  }
}, 1000);
